---
title: "Lista 6 - Iago Dutra"
output:
  html_document:
    df_print: paged
---
# Exercício 1
```{r}
library('gapminder')
library('ggplot2')

p <- ggplot(data = gapminder, mapping = aes(x = year, y = gdpPercap))
p + geom_line()

p + geom_line(aes(group = country))

p + geom_line(aes(group = country)) + facet_wrap(~continent)

p + geom_line(color="gray70", aes(group = country)) + 
  geom_smooth(size = 1.1, method = "loess", se = FALSE) + 
  scale_y_log10(labels=scales::dollar) + 
  facet_wrap(~ continent, ncol = 5) + 
  labs(x = "Year", 
    y = "GDP per capita", 
    title = "GDP per capita on Five Continents") 
```

```{r}
library('socviz')
p <- ggplot(data = gss_sm, 
  mapping = aes(x = age, y = childs)) 
p + geom_point(alpha = 0.2) + 
  geom_smooth() + 
  facet_grid(sex ~ race) 

p <- ggplot(data = gss_sm, mapping = aes(x = bigregion)) 
p + geom_bar() 
p + geom_bar(mapping = aes(y = ..prop..))
p + geom_bar(mapping = aes(y = ..prop.., group = 1)) 
table(gss_sm$religion) 


p <- ggplot(data = gss_sm, mapping = aes(x = religion, color = religion)) 
p + geom_bar() 
p <- ggplot(data = gss_sm, mapping = aes(x = religion, fill = religion)) 
p + geom_bar() + guides(fill = FALSE) 

p <- ggplot(data = gss_sm, mapping = aes(x = bigregion, fill = religion)) 
p + geom_bar() 
p + geom_bar(position = 'fill') 
p + geom_bar(position = "dodge", mapping = aes(y = ..prop..)) 
p + geom_bar(position = "dodge", mapping = aes(y = ..prop.., group = religion)) 
p + geom_bar(position = "dodge", mapping = aes(y = ..prop.., 
                                               group = bigregion)) + facet_wrap(~bigregion, ncol = 1) 

p <- ggplot(data = midwest, mapping = aes(x = area)) 
p + geom_histogram() 
p + geom_histogram(bins = 10) 
```

```{r}
oh_wi <- c("OH", "WI") 
p <- ggplot(data = subset(midwest, subset = state %in% oh_wi), 
            mapping = aes(x = percollege, fill = state)) 
p + geom_histogram(alpha = 0.4, bins = 20) 

p <- ggplot(data = midwest, mapping = aes(x = area)) 
p + geom_density() 

p <- ggplot(data = midwest, mapping = aes(x = area, fill = state, 
                                          color = state)) 
p + geom_density(alpha = 0.3) 

p <- ggplot(data = subset(midwest, subset = state %in% oh_wi), 
            mapping = aes(x = area, fill = state, color = state)) 
p + geom_density(alpha = 0.3, mapping = (aes(y = ..scaled..))) 
```

```{r}
p <- ggplot(data = titanic, mapping = aes(x = fate, y = percent, fill = sex))
p + geom_bar(position = "dodge", stat = "identity") + theme(legend.position = "top") 

oecd_sum

p <- ggplot(data = oecd_sum, mapping = aes(x = year, y = diff, fill = hi_lo)) 
p + geom_col() + guides(fill = 'none') + labs(x = NULL, y = "Difference in Years", title = "The US Life Expectancy Gap", subtitle = "Difference between US and OECD average life expectancies, 1960-2015", caption = "Data: OECD. After a chart by Christopher Ingraham, Washington Post, December 27th 2017.")
```

# Exercício 2

Usou-se a base de dados sobre os testes de um novo tratamento para a artrite reumatoide.

```{r}
library('tidyverse')
library('vcd')
Arthritis
```

```{r}
improv_by_treat <- Arthritis %>%
  group_by(Treatment, Improved) %>%
  summarize(N = n()) %>%
  mutate(freq = N / sum(N),
         pct = round((freq*100), 0))
improv_by_treat

improv_by_treat %>%
  group_by(Treatment) %>%
  summarize(total = sum(pct))

p <- ggplot(improv_by_treat, aes(x = Treatment, y = pct, fill = Improved))
p + geom_col(position = "dodge2") +
labs(x = "Tratamento",y = "Porcentagem", fill = "Melhora do quadro") +
theme(legend.position = "top") 

```

```{r}
p <- ggplot(improv_by_treat, aes(x = Improved, y = pct, fill = Improved))
p + geom_col(position = "dodge2") +
  labs(x = NULL, y = "Percent", fill = "Religion") +
  guides(fill = 'none') +
  coord_flip() +
  facet_grid(~ Treatment) 
```

```{r}
library('socviz')
gss_sm

gss_sm %>% select(1:6) %>% sample_n(size = 10) 

p <- ggplot(data = gss_sm, mapping = aes(x = degree, y = age))
p + geom_point() 
```

Olha só, o R ignora linhas sem algum dos dados e levanta um aviso (imaginava que o código quebraria).

```{r}
p <- ggplot(data = gss_sm, mapping = aes(x = ballot, y = childs))
p + geom_line(aes(group = sex)) + facet_wrap(~sex) +
    geom_point()
```

```{r}
p <- ggplot(data = gss_sm, mapping = aes(x = sex, y = childs))
p + geom_boxplot() + theme_bw() 

p <- ggplot(gss_sm, mapping = aes(x = sex, y = childs))
p + geom_boxplot() + coord_flip() 

p <- ggplot(data = gss_sm, mapping = aes(x = reorder(degree,
childs, na.rm = TRUE), y = childs))
p + geom_boxplot() + labs(x = NULL) + coord_flip() 

p <- ggplot(gss_sm, mapping = aes(x = reorder(degree, childs, na.rm=TRUE), y = childs, fill = polviews))
p + geom_boxplot() + labs(x=NULL) + coord_flip() + theme(legend.position = "top")

```

Como polviews e degree são independentes, foi necessário subdividir. No exemplo do livro, obviamente só é possível que cada governo possua uma ideologia.

```{r}
p <- ggplot(gss_sm, mapping = aes(x = reorder(degree, childs, na.rm=TRUE), y = childs, color = polviews))
p + geom_point() + labs(x=NULL) + coord_flip() + theme(legend.position = "top") 

p <- ggplot(gss_sm, mapping = aes(x = reorder(degree, childs, na.rm=TRUE), y = childs, color = polviews))
p + geom_jitter() + labs(x=NULL) + coord_flip() + theme(legend.position = "top") 
```

A aplicação do jitter permitiu visualizar os dados anteriormente sobrepostos. Como a variável childs é categórica, não há prejuízo para a exatidão da informação.

```{r}
p <- ggplot(gss_sm, mapping = aes(x = reorder(degree, childs, na.rm=TRUE), y = childs, color = polviews))

p + geom_jitter(position = position_jitter(width=0.15)) + 
    labs(x=NULL) + coord_flip() +
    theme(legend.position = "top") 


by_country <- gss_sm %>%
              group_by(degree, sex) %>%
              summarize(childs_mean= mean(childs, na.rm = TRUE),
                        childs_sd = sd(childs, na.rm = TRUE),
                        sibs_mean = mean(sibs, na.rm = TRUE))
by_country

by_country <- gss_sm %>%
              group_by(degree, sibs) %>%
              summarize_if(is.numeric, funs(mean, sd), na.rm = TRUE) %>%
              ungroup()
by_country

```

# Exercício 3
```{r}

```

# Exercício 4

O gráfico escolhido está disponível em <https://g1.globo.com/economia/noticia/2022/05/31/inflacao-e-protagonista-em-aumento-de-incerteza-com-economia-brasileira-diz-fgv-ibre.ghtml> (acesso em 31/05/2022).

![Um gráfico muito louco!](Capturar.PNG)

```{r}
library('tidyverse')

meses <- c('mai/21', 'jun/21', 'jul/21', 'ago/21', 'set/21', 'out/21', 'nov/21', 'dez/21', 'jan/22', 'fev/22', 'mar/22', 'abr/22', 'mai/22')

incerteza <- c(119.9, 122.3, 119.3, 119.6, 131.4, 127.1, 125.2, 118.7, 116.4, 117.1, 121.3, 114.9, 115.9)

indice <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13)

df <- data.frame(meses, incerteza, indice)
dadinhos <- as_tibble(df)

dadinhos

grafinho <- ggplot(dadinhos, aes(x = reorder(meses, indice),
                                 y = incerteza)) +
            geom_bar(stat = 'identity',
                     width = 0.70,
                     fill = 'pink') +
            labs(x = NULL,
                 y = NULL,
                 title = 'Indicador de incerteza na economia',
                 subtitle = 'Em pontos',
                 caption = 'Fonte: Ibre/FGV') +
            geom_text(label = dadinhos$incerteza, nudge_y = 10) +
            theme(panel.background = element_rect(fill = 'white'),
                  plot.caption = element_text(hjust = 0),
                  axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
                  panel.grid.major.y = element_line(colour = "black", size = 0.5)) +
            scale_y_continuous(labels = scales::number_format(accuracy = 0.1)) +
            geom_bar(data = filter(dadinhos, indice == 13),
                     stat = 'identity',
                     width = 0.70,
                     fill = 'red')

grafinho
```

  O ajuste de cada elemento não é difícil, mas requer pesquisar a sintaxe específica (embora seja possível "chutar" e acertar às vezes).

  Como este gráfico foi produzido antes de entrar em contato com a biblioteca Lubridate, criei uma coluna índice para poder ordenar os dados, já que o padrão é ordem alfabética.